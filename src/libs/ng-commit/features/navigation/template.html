<ng-container *ngIf="{activeNodeData: activeNodeData$ | async} as $">
  <tui-input #filter (keyup)="onFilterChanged(filter.value)">Filter</tui-input>

  <tui-tree
    *ngFor="let item of ((node$ | async)?.children ?? [])"
    [tuiTreeController]="true"
    [value]="item"
    [content]="content"
    [childrenHandler]="handler"
  ></tui-tree>

  <ng-template #content let-item>
    <ll-result [data]="item.data" *ngIf="item.data">
      <ng-container *ifSuccess="item.data; let ok">
        <tui-svg
          *ngIf="ok === $.activeNodeData && ok !== undefined"
          src="tuiIconCheck"
        ></tui-svg>
        <span
          tuiIconButton
          icon=""
          class="tree-item"
          [class.active]="ok === $.activeNodeData && ok !== undefined"
          (click)="onSelect($any(ok))"
        >
          {{ item.text }}
        </span>
      </ng-container>
      <span *llFailure="let fail">{{fail}}</span>
    </ll-result>
    <span *ngIf="!item.data"> {{ item.text }}</span>
  </ng-template>
</ng-container>
